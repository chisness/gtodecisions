<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>#1: Expected Value – Behind the Cards and Beyond the Bets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-K22WMCCPJ4"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-K22WMCCPJ4', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="#1: Expected Value – Behind the Cards and Beyond the Bets">
<meta property="og:description" content="">
<meta property="og:site_name" content="Behind the Cards and Beyond the Bets">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Behind the Cards and Beyond the Bets</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
    <a href="https://forms.gle/JG7jd2KAUp3UWx4r7" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-mailbox2-flag"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../course/expectedvalue.html">Sessions</a></li><li class="breadcrumb-item"><a href="../course/expectedvalue.html">#1: Expected Value</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fall 2024</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Sessions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course/expectedvalue.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">#1: Expected Value</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course/gametheory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">#2: Game Theory</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course/changingyourmind.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">#3: Changing Your Mind</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course/riskandluck.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">#4: Risk and Luck</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intros" id="toc-intros" class="nav-link active" data-scroll-target="#intros">Intros</a></li>
  <li><a href="#expected-value-examples" id="toc-expected-value-examples" class="nav-link" data-scroll-target="#expected-value-examples">Expected Value Examples</a>
  <ul class="collapse">
  <li><a href="#rain-and-umbrellas" id="toc-rain-and-umbrellas" class="nav-link" data-scroll-target="#rain-and-umbrellas">Rain and Umbrellas</a></li>
  <li><a href="#poker" id="toc-poker" class="nav-link" data-scroll-target="#poker">Poker</a></li>
  <li><a href="#basketball-shots" id="toc-basketball-shots" class="nav-link" data-scroll-target="#basketball-shots">Basketball Shots</a></li>
  </ul></li>
  <li><a href="#group-discussion" id="toc-group-discussion" class="nav-link" data-scroll-target="#group-discussion">Group Discussion</a>
  <ul class="collapse">
  <li><a href="#robbing-a-bank" id="toc-robbing-a-bank" class="nav-link" data-scroll-target="#robbing-a-bank">Robbing a Bank</a></li>
  <li><a href="#turning-back-on-everest" id="toc-turning-back-on-everest" class="nav-link" data-scroll-target="#turning-back-on-everest">Turning Back on Everest</a></li>
  <li><a href="#picking-a-job" id="toc-picking-a-job" class="nav-link" data-scroll-target="#picking-a-job">Picking a Job</a></li>
  </ul></li>
  <li><a href="#fun-games" id="toc-fun-games" class="nav-link" data-scroll-target="#fun-games">Fun Games</a>
  <ul class="collapse">
  <li><a href="#birthday-order" id="toc-birthday-order" class="nav-link" data-scroll-target="#birthday-order">Birthday Order</a></li>
  <li><a href="#birthday-sum" id="toc-birthday-sum" class="nav-link" data-scroll-target="#birthday-sum">Birthday Sum</a></li>
  <li><a href="#word-modal-length" id="toc-word-modal-length" class="nav-link" data-scroll-target="#word-modal-length">Word Modal Length</a></li>
  <li><a href="#word-most-common-letter" id="toc-word-most-common-letter" class="nav-link" data-scroll-target="#word-most-common-letter">Word Most Common Letter</a></li>
  <li><a href="#game" id="toc-game" class="nav-link" data-scroll-target="#game">2/3 Game</a></li>
  </ul></li>
  <li><a href="#poker-games" id="toc-poker-games" class="nav-link" data-scroll-target="#poker-games">Poker Games</a></li>
  <li><a href="#location" id="toc-location" class="nav-link" data-scroll-target="#location">Location</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../course/expectedvalue.html">Sessions</a></li><li class="breadcrumb-item"><a href="../course/expectedvalue.html">#1: Expected Value</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">#1: Expected Value</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="intros" class="level2">
<h2 class="anchored" data-anchor-id="intros">Intros</h2>
<p>In the 1st session we started with some intros. Some things people mentioned that they want to get from the course:</p>
<ul>
<li>Quick math on the fly</li>
<li>Apply to trading and improve math</li>
<li>Meet interesting people</li>
<li>Thinking in bets applied to real life</li>
<li>Meet cool people</li>
<li>Better decision making</li>
<li>How to teach these ideas</li>
</ul>
</section>
<section id="expected-value-examples" class="level2">
<h2 class="anchored" data-anchor-id="expected-value-examples">Expected Value Examples</h2>
<p>We went through a few basic expected value examples to get the hang of it.</p>
<section id="rain-and-umbrellas" class="level3">
<h3 class="anchored" data-anchor-id="rain-and-umbrellas">Rain and Umbrellas</h3>
<p>How much would you pay to have an umbrella if it was raining and you didn’t already have one?</p>
<p>How much would you pay to not have to carry an umbrella if there was no rain and you were already carrying one?</p>
<p>These are the answers from the class:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Rain and No Umbrella</th>
<th>No Rain and Carrying Umbrella</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>$10</td>
<td>$0</td>
</tr>
<tr class="even">
<td>$20</td>
<td>$1</td>
</tr>
<tr class="odd">
<td>$5</td>
<td>$2</td>
</tr>
<tr class="even">
<td>$5</td>
<td>$1</td>
</tr>
<tr class="odd">
<td>$7</td>
<td>$3</td>
</tr>
<tr class="even">
<td>$10</td>
<td>$10</td>
</tr>
<tr class="odd">
<td>$10</td>
<td>$5</td>
</tr>
<tr class="even">
<td>$20</td>
<td>$5</td>
</tr>
<tr class="odd">
<td>$3</td>
<td>$3</td>
</tr>
<tr class="even">
<td>$25</td>
<td>$10</td>
</tr>
</tbody>
</table>
<p>Rain and No Umbrella average: $115/10 = $11.50</p>
<p>No Rain and Umbrella average: $40/10 = $4.00</p>
<p>From here we ask what is the breakeven percentage chance of rain that this average person should choose to carry vs.&nbsp;not carry an umbrella?</p>
<p><span class="math display">\[
\begin{equation}
\begin{split}
11.5*P(\text{rain}) &amp;= 4*P(\text{no rain}) &amp;&amp; \Rightarrow \text{Let } P(\text{rain}) = p \\
11.5*p &amp;= 4*(1-p) \\
11.5*p &amp;= 4 - 4*p \\
15.5*p &amp;= 4 \\
p &amp;= .258 \\
&amp;= 25.8\%
\end{split}
\end{equation}
\]</span></p>
<p>Therefore if it’s more than 25.8% probable to rain, this person should take an umbrella, and if less then 25.8% then they should leave it at home.</p>
</section>
<section id="poker" class="level3">
<h3 class="anchored" data-anchor-id="poker">Poker</h3>
<p>Next we looked at this poker hand:</p>
<p><img src="pokerhand.jpg" class="img-fluid"></p>
<p>What is the probability of winning the hand as the player with the 3♥4♥?</p>
<p>We see 8 total cards (our 2, opponent 2, and board 4). We need a heart of which there are 13 in the deck, but 4 already out (2 in our hand, 2 on the board).</p>
<p>Therefore the odds of hitting our heart are 9/44 = 0.2 (rounding).</p>
<p>Assume that the pot is currently $120.</p>
<p>What all-in bet from our opponent can we profitably call?</p>
<p>We know that a tiny bet of $1 will definitely give us the correct odds of calling. We know that a huge bet of $10,000 will definitely not give us the correct odds of calling.</p>
<p>We can calculate this mathematically. Let <span class="math inline">\(b\)</span> be the opponent’s bet size that we have to call.</p>
<p>Total pot if we call = <span class="math inline">\(120 + b + b\)</span>.</p>
<p>Our equity of this pot is <span class="math inline">\(0.2\)</span>.</p>
<p>Therefore we breakeven when <span class="math inline">\(b = 0.2*(120 + 2b)\)</span>.</p>
<p><span class="math display">\[
\begin{equation}
\begin{split}
b &amp;= 24 + 0.4b \\
0.6b &amp;= 24 \\
b &amp;= 40
\end{split}
\end{equation}
\]</span></p>
<p>Therefore when the bet size is 40 we are indifferent to calling and folding. When it’s more than 40, we don’t have sufficient odds to call and should fold. When it’s less than 40, we have profitable odds to call and should call.</p>
<p>Note that we make the call even when we are unlikely to win! This is because we’re making the decision based on the probabilities.</p>
</section>
<section id="basketball-shots" class="level3">
<h3 class="anchored" data-anchor-id="basketball-shots">Basketball Shots</h3>
</section>
</section>
<section id="group-discussion" class="level2">
<h2 class="anchored" data-anchor-id="group-discussion">Group Discussion</h2>
<p>We talked about how these EV examples are relatively straightforward, but there are many factors that are not always easily quantifiable. There are also cases where our preferences (utility functions) are not aligned with the $EV. For example, if offered a coinflip for $100m vs.&nbsp;a free $40m, you’d probably need to be very rich or very risk-seeking to prefer the flip.</p>
<p>Other examples:</p>
<ul>
<li>Insurance</li>
<li>Loss aversion (losing $1000 worse than winning $1000)</li>
<li>Value of time</li>
<li>Opportunity cost</li>
<li>Something that’s -EV now but can open up a +EV opportunity later</li>
<li>Moral issues</li>
<li>Stress avoidance</li>
</ul>
<p>We split into groups where teams made up example scenarios that were less straightforward.</p>
<section id="robbing-a-bank" class="level3">
<h3 class="anchored" data-anchor-id="robbing-a-bank">Robbing a Bank</h3>
<p>What if you need to rob a bank to pay for your dog’s surgery? You might be thinking “There are probably better options”. But let’s check the EV just to be sure:</p>
<div class="grid">
<div class="g-col-6">
<p><img src="bank.jpg" class="img-fluid"></p>
</div>
<div class="g-col-6">
<p><img src="bankzoom.jpg" class="img-fluid"></p>
</div>
</div>
<p>Here we see that with 30% probability you immediately go to jail, which is worth -$100k.</p>
<p>With 70% probability, you successfully rob the bank for $10k.</p>
<p>But then once you successfully rob the bank, apparently the strategy is to rob another one. This works 80% of the time for another $10k. And if it fails, your loss is -$125k (only marginally worse than getting caught the first time). (Note that the tree diagram shows -$25k, but meant this in addition to the original possible loss.)</p>
<p>Finally, if you succeded twice, you give it one last try, but this time is only 50% successful for another $10k and risks loss of -$133k.</p>
<p>So what’s the EV of success?</p>
<p><span class="math inline">\(0.7*0.8*0.5 = 0.28\)</span> you will get $30k, for an EV of <span class="math inline">\(\$30*.28 = 8.4k\)</span></p>
<p>0.28 you get 30k Worth $8400 EV</p>
<p>0.3 you get -100k = -30k</p>
<p>.14 you get -125k = -17.5k</p>
<p>.28 you get -133k = -37.24k</p>
<p>-84.74k</p>
<p>+8.4k</p>
<p>Net -76.34k</p>
<p>28% +$30k 72% in jail</p>
</section>
<section id="turning-back-on-everest" class="level3">
<h3 class="anchored" data-anchor-id="turning-back-on-everest">Turning Back on Everest</h3>
</section>
<section id="picking-a-job" class="level3">
<h3 class="anchored" data-anchor-id="picking-a-job">Picking a Job</h3>
</section>
</section>
<section id="fun-games" class="level2">
<h2 class="anchored" data-anchor-id="fun-games">Fun Games</h2>
<section id="birthday-order" class="level3">
<h3 class="anchored" data-anchor-id="birthday-order">Birthday Order</h3>
</section>
<section id="birthday-sum" class="level3">
<h3 class="anchored" data-anchor-id="birthday-sum">Birthday Sum</h3>
</section>
<section id="word-modal-length" class="level3">
<h3 class="anchored" data-anchor-id="word-modal-length">Word Modal Length</h3>
</section>
<section id="word-most-common-letter" class="level3">
<h3 class="anchored" data-anchor-id="word-most-common-letter">Word Most Common Letter</h3>
</section>
<section id="game" class="level3">
<h3 class="anchored" data-anchor-id="game">2/3 Game</h3>
</section>
</section>
<section id="poker-games" class="level2">
<h2 class="anchored" data-anchor-id="poker-games">Poker Games</h2>
<p>We want to run this on Sundays. We’ll send out a message soon about scheduling and more info. We’ll probably do an online game on:</p>
<ul>
<li>Sun Sep 29</li>
<li>Sun Oct 6</li>
<li>Sun Oct 13</li>
</ul>
<p>Then a final in person game on:</p>
<ul>
<li>Mon Oct 14 after the final class</li>
</ul>
</section>
<section id="location" class="level2">
<h2 class="anchored" data-anchor-id="location">Location</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="outside.jpg" class="img-fluid figure-img"></p>
<figcaption>Outside</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="inside.jpg" class="img-fluid figure-img"></p>
<figcaption>Inside</figcaption>
</figure>
</div>



</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>